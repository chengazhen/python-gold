name: ç®€åŒ–ç‰ˆæ¯æ—¥é»„é‡‘æ•°æ®è·å–

on:
  schedule:
    # æ¯å¤©åŒ—äº¬æ—¶é—´ä¸Šåˆ10ç‚¹ (UTC+8 = UTC 02:00)
    - cron: '0 2 * * *'
  workflow_dispatch: # å…è®¸æ‰‹åŠ¨è§¦å‘

jobs:
  fetch-data:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v4
    
    - name: è®¾ç½®Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'
        
    - name: å®‰è£…ä¾èµ–
      run: |
        pip install requests pandas openpyxl
        
    - name: è·å–é»„é‡‘æ•°æ®
      run: |
        cd gold
        python xinlang.py
        
    - name: æäº¤æ•°æ®
      run: |
        cd gold
        git config user.name "GitHub Action"
        git config user.email "action@github.com"
        
        # æ·»åŠ æ•°æ®æ–‡ä»¶
        git add *.json *.xlsx *.html
        
        # æ£€æŸ¥æ˜¯å¦æœ‰å˜åŒ–
        if ! git diff --cached --quiet; then
          # ç”Ÿæˆæäº¤ä¿¡æ¯
          DATE=$(date '+%Y-%m-%d %H:%M')
          git commit -m "ğŸ”„ è‡ªåŠ¨æ›´æ–°é»„é‡‘æ•°æ® ${DATE}"
          git push
          echo "âœ… æ•°æ®å·²æ›´æ–°å¹¶æäº¤"
        else
          echo "â„¹ï¸ æ²¡æœ‰æ•°æ®å˜åŒ–ï¼Œè·³è¿‡æäº¤"
        fi
