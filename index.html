<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é¦–é¥°é»„é‡‘ä»·æ ¼æ•°æ®åˆ†ææŠ¥å‘Š</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/date-fns@2.29.3/index.min.js"></script>
    <script src="gold_data.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            text-align: center;
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 10px;
        }

        .stat-label {
            font-size: 1rem;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .chart-container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .chart-title {
            font-size: 1.5rem;
            margin-bottom: 20px;
            color: #333;
            text-align: center;
        }

        .chart-wrapper {
            position: relative;
            height: 400px;
            margin-bottom: 20px;
        }

        .tabs {
            display: flex;
            background: white;
            border-radius: 15px;
            margin-bottom: 30px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .tab {
            flex: 1;
            padding: 15px 20px;
            background: #f8f9fa;
            border: none;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .tab.active {
            background: #667eea;
            color: white;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .data-table th,
        .data-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }

        .data-table th {
            background: #f8f9fa;
            font-weight: bold;
            color: #333;
        }

        .data-table tr:hover {
            background: #f8f9fa;
        }

        .price-up {
            color: #e74c3c;
            font-weight: bold;
        }

        .price-down {
            color: #27ae60;
            font-weight: bold;
        }

        .price-same {
            color: #95a5a6;
            font-weight: bold;
        }

        .brand-legend {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin: 20px 0;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 50%;
        }

        .filters {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .filter-group label {
            font-size: 0.9rem;
            color: #666;
        }

        .filter-group select {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background: white;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .stats-grid {
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                gap: 15px;
            }
            
            .chart-wrapper {
                height: 300px;
            }
            
            .filters {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ† é»„é‡‘ä»·æ ¼æ•°æ®åˆ†ææŠ¥å‘Š</h1>
            <p>åŸºäºæ–°æµªè´¢ç»æ•°æ®çš„æ·±åº¦åˆ†æ | æ”¯æŒé¦–é¥°é»„é‡‘ã€å®ç‰©é»„é‡‘ã€é‡‘æ¡æ•°æ®</p>

            <!-- æ•°æ®ç±»å‹é€‰æ‹©å™¨ -->
            <div style="margin-top: 20px;">
                <select id="goldTypeSelector" onchange="switchGoldType()" style="padding: 10px 15px; font-size: 16px; border-radius: 8px; border: 2px solid white; background: rgba(255,255,255,0.9); color: #333;">
                    <option value="jewelry">é¦–é¥°é»„é‡‘</option>
                    <option value="physical">å®ç‰©é»„é‡‘</option>
                    <option value="gold_bar">é‡‘æ¡</option>
                    <option value="all">å…¨éƒ¨ç±»å‹å¯¹æ¯”</option>
                </select>
            </div>
        </div>

        <!-- ç»Ÿè®¡æ¦‚è§ˆ -->
        <div class="stats-grid">
            <!-- <div class="stat-card">
                <div class="stat-value" id="totalRecords">50</div>
                <div class="stat-label">æ€»è®°å½•æ•°</div>
            </div> -->
            <div class="stat-card">
                <div class="stat-value" id="avgPrice">åŠ è½½ä¸­...</div>
                <div class="stat-label">å¹³å‡ä»·æ ¼(å…ƒ/å…‹)</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="maxPrice">åŠ è½½ä¸­...</div>
                <div class="stat-label">æœ€é«˜ä»·æ ¼(å…ƒ/å…‹)</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="minPrice">åŠ è½½ä¸­...</div>
                <div class="stat-label">æœ€ä½ä»·æ ¼(å…ƒ/å…‹)</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="risePercent">åŠ è½½ä¸­...</div>
                <div class="stat-label">ä¸Šæ¶¨æ¯”ä¾‹</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="brandCount">åŠ è½½ä¸­...</div>
                <div class="stat-label">å“ç‰Œæ•°é‡</div>
            </div>
        </div>

        <!-- æ ‡ç­¾é¡µ -->
        <div class="tabs">
            <button class="tab active" onclick="showTab('trend')">ä»·æ ¼è¶‹åŠ¿</button>
            <button class="tab" onclick="showTab('brand')">å“ç‰Œå¯¹æ¯”</button>
            <button class="tab" onclick="showTab('comparison')">ç±»å‹å¯¹æ¯”</button>
            <button class="tab" onclick="showTab('table')">æ•°æ®è¡¨æ ¼</button>
            <button class="tab" onclick="showTab('analysis')">æ·±åº¦åˆ†æ</button>
        </div>

        <!-- ä»·æ ¼è¶‹åŠ¿å›¾ -->
        <div id="trend" class="tab-content active">
            <div class="chart-container">
                <h3 class="chart-title">é»„é‡‘ä»·æ ¼èµ°åŠ¿å›¾</h3>
                <div class="filters">
                    <div class="filter-group">
                        <label>é€‰æ‹©å“ç‰Œ:</label>
                        <select id="brandFilter" onchange="updateTrendChart()">
                            <option value="all">å…¨éƒ¨å“ç‰Œ</option>
                            <option value="å‘¨å¤§ç¦">å‘¨å¤§ç¦</option>
                            <option value="å…­ç¦">å…­ç¦</option>
                            <option value="å‘¨ç”Ÿç”Ÿ">å‘¨ç”Ÿç”Ÿ</option>
                        </select>
                    </div>
                </div>
                <div class="chart-wrapper">
                    <canvas id="trendChart"></canvas>
                </div>
                <div class="brand-legend">
                    <div class="legend-item">
                        <div class="legend-color" style="background: #667eea;"></div>
                        <span>å‘¨å¤§ç¦</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #f093fb;"></div>
                        <span>å…­ç¦</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #4facfe;"></div>
                        <span>å‘¨ç”Ÿç”Ÿ</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- å“ç‰Œå¯¹æ¯”å›¾ -->
        <div id="brand" class="tab-content">
            <div class="chart-container">
                <h3 class="chart-title">å“ç‰Œä»·æ ¼å¯¹æ¯”</h3>
                <div class="chart-wrapper">
                    <canvas id="brandChart"></canvas>
                </div>
            </div>
        </div>

        <!-- ç±»å‹å¯¹æ¯”å›¾ -->
        <div id="comparison" class="tab-content">
            <div class="chart-container">
                <h3 class="chart-title">é»„é‡‘ç±»å‹ä»·æ ¼å¯¹æ¯”</h3>
                <div class="chart-wrapper">
                    <canvas id="comparisonChart"></canvas>
                </div>
                <div style="margin-top: 20px; text-align: center; color: #666;">
                    <p>å¯¹æ¯”ä¸åŒç±»å‹é»„é‡‘çš„å¹³å‡ä»·æ ¼ã€ä»·æ ¼åŒºé—´å’Œæ³¢åŠ¨æƒ…å†µ</p>
                </div>
            </div>
        </div>

        <!-- æ•°æ®è¡¨æ ¼ -->
        <div id="table" class="tab-content">
            <div class="chart-container">
                <h3 class="chart-title">è¯¦ç»†æ•°æ®è¡¨æ ¼</h3>
                <div class="filters">
                    <div class="filter-group">
                        <label>ç­›é€‰å“ç‰Œ:</label>
                        <select id="tableBrandFilter" onchange="updateTable()">
                            <option value="all">å…¨éƒ¨å“ç‰Œ</option>
                            <option value="å‘¨å¤§ç¦">å‘¨å¤§ç¦</option>
                            <option value="å…­ç¦">å…­ç¦</option>
                            <option value="å‘¨ç”Ÿç”Ÿ">å‘¨ç”Ÿç”Ÿ</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>æ’åºæ–¹å¼:</label>
                        <select id="sortBy" onchange="updateTable()">
                            <option value="date">æŒ‰æ—¥æœŸ</option>
                            <option value="price">æŒ‰ä»·æ ¼</option>
                            <option value="brand">æŒ‰å“ç‰Œ</option>
                        </select>
                    </div>
                </div>
                <table class="data-table" id="dataTable">
                    <thead>
                        <tr>
                            <th>æ—¥æœŸ</th>
                            <th>é»„é‡‘ç±»å‹</th>
                            <th>å“ç‰Œ</th>
                            <th>äº§å“</th>
                            <th>ä»·æ ¼(å…ƒ/å…‹)</th>
                            <th>æ¶¨è·Œ</th>
                            <th>æ•°æ®æ¥æº</th>
                        </tr>
                    </thead>
                    <tbody id="tableBody">
                    </tbody>
                </table>
            </div>
        </div>

        <!-- æ·±åº¦åˆ†æ -->
        <div id="analysis" class="tab-content">
            <div class="chart-container">
                <h3 class="chart-title">æ·±åº¦åˆ†ææŠ¥å‘Š</h3>
                <div style="line-height: 1.8; font-size: 1.1rem;">
                    <h4 style="color: #667eea; margin: 20px 0 15px 0;">ğŸ“Š æ•°æ®æ¦‚è§ˆ</h4>
                    <p>æœ¬æ¬¡åˆ†ææ¶µç›–2025å¹´9æœˆ1æ—¥è‡³17æ—¥å…±17å¤©çš„é»„é‡‘ä»·æ ¼æ•°æ®ï¼ŒåŒ…å«å‘¨å¤§ç¦ã€å…­ç¦ã€å‘¨ç”Ÿç”Ÿä¸‰å¤§çŸ¥åç å®å“ç‰Œçš„50æ¡æœ‰æ•ˆè®°å½•ã€‚</p>
                    
                    <h4 style="color: #667eea; margin: 20px 0 15px 0;">ğŸ“ˆ ä»·æ ¼è¶‹åŠ¿åˆ†æ</h4>
                    <p>â€¢ <strong>ä»·æ ¼åŒºé—´ï¼š</strong>921-1077å…ƒ/å…‹ï¼Œæ³¢åŠ¨å¹…åº¦è¾¾156å…ƒ/å…‹<br>
                    â€¢ <strong>å¹³å‡ä»·æ ¼ï¼š</strong>1021.4å…ƒ/å…‹ï¼Œä¸­ä½æ•°ä¸º1050å…ƒ/å…‹<br>
                    â€¢ <strong>æ•´ä½“è¶‹åŠ¿ï¼š</strong>56%çš„è®°å½•æ˜¾ç¤ºä»·æ ¼ä¸Šæ¶¨ï¼Œä»…8%ä¸‹è·Œï¼Œ36%æŒå¹³</p>
                    
                    <h4 style="color: #667eea; margin: 20px 0 15px 0;">ğŸ¢ å“ç‰Œè¡¨ç°å¯¹æ¯”</h4>
                    <p>â€¢ <strong>å‘¨å¤§ç¦ï¼š</strong>17æ¡è®°å½•ï¼Œä»·æ ¼ç›¸å¯¹ç¨³å®šï¼Œå¤šåœ¨1050-1077å…ƒåŒºé—´<br>
                    â€¢ <strong>å…­ç¦ï¼š</strong>17æ¡è®°å½•ï¼Œä¸å‘¨å¤§ç¦ä»·æ ¼é«˜åº¦ä¸€è‡´<br>
                    â€¢ <strong>å‘¨ç”Ÿç”Ÿï¼š</strong>16æ¡è®°å½•ï¼Œä»·æ ¼æ˜æ˜¾ä½äºå‰ä¸¤è€…ï¼Œå¤šåœ¨921-966å…ƒåŒºé—´</p>
                    
                    <h4 style="color: #667eea; margin: 20px 0 15px 0;">ğŸ’¡ æŠ•èµ„å»ºè®®</h4>
                    <p>â€¢ å‘¨ç”Ÿç”Ÿä»·æ ¼ç›¸å¯¹è¾ƒä½ï¼Œå¯èƒ½å­˜åœ¨æŠ•èµ„æœºä¼š<br>
                    â€¢ å‘¨å¤§ç¦å’Œå…­ç¦ä»·æ ¼èµ°åŠ¿é«˜åº¦ä¸€è‡´ï¼Œå»ºè®®å…³æ³¨å¸‚åœºæ•´ä½“è¶‹åŠ¿<br>
                    â€¢ è¿‘æœŸä»·æ ¼ä¸Šæ¶¨è¶‹åŠ¿æ˜æ˜¾ï¼Œéœ€å…³æ³¨é£é™©æ§åˆ¶</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // å…¨å±€å˜é‡å­˜å‚¨æ•°æ®
        let allGoldData = {
            jewelry: [],
            physical: [],
            gold_bar: []
        };
        let currentGoldType = 'jewelry';
        let goldData = []; // å½“å‰æ˜¾ç¤ºçš„æ•°æ®

        // æ•°æ®æ–‡ä»¶æ˜ å°„
        const dataFiles = {
            jewelry: 'jewelry_gold_latest.json',
            physical: 'physical_gold_latest.json',
            gold_bar: 'gold_bar_latest.json'
        };

        // ä»JSONæ–‡ä»¶åŠ è½½æ•°æ®
        async function loadGoldData() {
            try {
                // åŠ è½½æ‰€æœ‰ç±»å‹çš„æ•°æ®
                for (const [type, filename] of Object.entries(dataFiles)) {
                    try {
                        const response = await fetch(filename);
                        if (response.ok) {
                            allGoldData[type] = await response.json();
                            console.log(`${type}æ•°æ®åŠ è½½æˆåŠŸï¼Œå…±${allGoldData[type].length}æ¡è®°å½•`);
                        } else {
                            console.warn(`æ— æ³•åŠ è½½${filename}æ–‡ä»¶`);
                            allGoldData[type] = [];
                        }
                    } catch (error) {
                        console.warn(`åŠ è½½${filename}å¤±è´¥:`, error);
                        allGoldData[type] = [];
                    }
                }

                // è®¾ç½®åˆå§‹æ•°æ®
                switchGoldType();

            } catch (error) {
                console.error('åŠ è½½æ•°æ®å¤±è´¥:', error);
                // å¦‚æœåŠ è½½å¤±è´¥ï¼Œå°è¯•åŠ è½½æ—§æ ¼å¼æ•°æ®
                try {
                    const response = await fetch('gold_data_complete.json');
                    if (response.ok) {
                        goldData = await response.json();
                        allGoldData.jewelry = goldData;
                        initializePage();
                    }
                } catch (fallbackError) {
                    document.body.innerHTML = `
                        <div style="text-align: center; padding: 50px; color: red;">
                            <h2>æ•°æ®åŠ è½½å¤±è´¥</h2>
                            <p>æ— æ³•åŠ è½½é»„é‡‘æ•°æ®æ–‡ä»¶</p>
                            <p>è¯·ç¡®ä¿æ•°æ®æ–‡ä»¶å­˜åœ¨</p>
                        </div>
                    `;
                }
            }
        }

        // åˆ‡æ¢é»„é‡‘ç±»å‹
        function switchGoldType() {
            const selector = document.getElementById('goldTypeSelector');
            currentGoldType = selector.value;

            if (currentGoldType === 'all') {
                // åˆå¹¶æ‰€æœ‰æ•°æ®ç”¨äºå¯¹æ¯”
                goldData = [
                    ...allGoldData.jewelry,
                    ...allGoldData.physical,
                    ...allGoldData.gold_bar
                ];
            } else {
                goldData = allGoldData[currentGoldType] || [];
            }

            console.log(`åˆ‡æ¢åˆ°${currentGoldType}ï¼Œæ•°æ®é‡:${goldData.length}`);
            initializePage();
        }

        // åˆå§‹åŒ–é¡µé¢
        function initializePage() {
            updateStatistics();
            updateTrendChart();
            updateBrandChart();
            updateComparisonChart();
            updateTable();
        }

        // æ›´æ–°ç»Ÿè®¡æ•°æ®
        function updateStatistics() {
            if (goldData.length === 0) return;

            // è®¡ç®—ç»Ÿè®¡æ•°æ®
            const prices = goldData.map(item => item.ä»·æ ¼_æ•°å€¼);
            const avgPrice = (prices.reduce((sum, price) => sum + price, 0) / prices.length).toFixed(1);
            const maxPrice = Math.max(...prices).toFixed(1);
            const minPrice = Math.min(...prices).toFixed(1);

            // è®¡ç®—ä¸Šæ¶¨æ¯”ä¾‹
            const riseCount = goldData.filter(item => item.æ¶¨è·Œ === 'æ¶¨').length;
            const risePercent = ((riseCount / goldData.length) * 100).toFixed(1);

            // è®¡ç®—å“ç‰Œæ•°é‡
            const brands = [...new Set(goldData.map(item => item.å“ç‰Œ))];
            const brandCount = brands.length;

            // æ›´æ–°é¡µé¢æ˜¾ç¤º
            document.getElementById('avgPrice').textContent = avgPrice;
            document.getElementById('maxPrice').textContent = maxPrice;
            document.getElementById('minPrice').textContent = minPrice;
            document.getElementById('risePercent').textContent = risePercent + '%';
            document.getElementById('brandCount').textContent = brandCount;
        }

        let trendChart, brandChart, comparisonChart;

        // æ ‡ç­¾é¡µåˆ‡æ¢
        function showTab(tabName) {
            // éšè—æ‰€æœ‰æ ‡ç­¾é¡µå†…å®¹
            const contents = document.querySelectorAll('.tab-content');
            contents.forEach(content => content.classList.remove('active'));
            
            // ç§»é™¤æ‰€æœ‰æ ‡ç­¾çš„activeç±»
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => tab.classList.remove('active'));
            
            // æ˜¾ç¤ºé€‰ä¸­çš„æ ‡ç­¾é¡µ
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
            
            // å¦‚æœåˆ‡æ¢åˆ°å›¾è¡¨æ ‡ç­¾é¡µï¼Œé‡æ–°æ¸²æŸ“å›¾è¡¨
            if (tabName === 'trend' && trendChart) {
                updateTrendChart();
            } else if (tabName === 'brand' && brandChart) {
                updateBrandChart();
            } else if (tabName === 'comparison' && comparisonChart) {
                updateComparisonChart();
            } else if (tabName === 'table') {
                updateTable();
            }
        }

        // æ›´æ–°è¶‹åŠ¿å›¾
        function updateTrendChart() {
            const selectedBrand = document.getElementById('brandFilter').value;
            let filteredData = goldData;
            
            if (selectedBrand !== 'all') {
                filteredData = goldData.filter(item => item.å“ç‰Œ === selectedBrand);
            }
            
            // æŒ‰æ—¥æœŸåˆ†ç»„æ•°æ®
            const groupedData = {};
            filteredData.forEach(item => {
                if (!groupedData[item.æ—¥æœŸ]) {
                    groupedData[item.æ—¥æœŸ] = {};
                }
                groupedData[item.æ—¥æœŸ][item.å“ç‰Œ] = item.ä»·æ ¼_æ•°å€¼;
            });
            
            const dates = Object.keys(groupedData).sort();
            const brands = ['å‘¨å¤§ç¦', 'å…­ç¦', 'å‘¨ç”Ÿç”Ÿ'];
            const colors = ['#667eea', '#f093fb', '#4facfe'];
            
            const datasets = brands.map((brand, index) => {
                const data = dates.map(date => groupedData[date][brand] || null);
                return {
                    label: brand,
                    data: data,
                    borderColor: colors[index],
                    backgroundColor: colors[index] + '20',
                    fill: false,
                    tension: 0.4,
                    pointRadius: 4,
                    pointHoverRadius: 6
                };
            });
            
            if (trendChart) {
                trendChart.destroy();
            }
            
            const ctx = document.getElementById('trendChart').getContext('2d');
            trendChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: dates,
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'é»„é‡‘ä»·æ ¼èµ°åŠ¿å›¾'
                        },
                        legend: {
                            display: true,
                            position: 'top'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false,
                            title: {
                                display: true,
                                text: 'ä»·æ ¼ (å…ƒ/å…‹)'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'æ—¥æœŸ'
                            }
                        }
                    }
                }
            });
        }

        // æ›´æ–°å“ç‰Œå¯¹æ¯”å›¾
        function updateBrandChart() {
            const brandStats = {};
            goldData.forEach(item => {
                if (!brandStats[item.å“ç‰Œ]) {
                    brandStats[item.å“ç‰Œ] = {
                        prices: [],
                        count: 0
                    };
                }
                brandStats[item.å“ç‰Œ].prices.push(item.ä»·æ ¼_æ•°å€¼);
                brandStats[item.å“ç‰Œ].count++;
            });

            const brands = Object.keys(brandStats);
            const avgPrices = brands.map(brand => {
                const prices = brandStats[brand].prices;
                return prices.reduce((sum, price) => sum + price, 0) / prices.length;
            });

            if (brandChart) {
                brandChart.destroy();
            }

            const ctx = document.getElementById('brandChart').getContext('2d');
            brandChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: brands,
                    datasets: [{
                        label: 'å¹³å‡ä»·æ ¼ (å…ƒ/å…‹)',
                        data: avgPrices,
                        backgroundColor: ['#667eea', '#f093fb', '#4facfe'],
                        borderColor: ['#667eea', '#f093fb', '#4facfe'],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'å“ç‰Œå¹³å‡ä»·æ ¼å¯¹æ¯”'
                        },
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false,
                            title: {
                                display: true,
                                text: 'å¹³å‡ä»·æ ¼ (å…ƒ/å…‹)'
                            }
                        }
                    }
                }
            });
        }

        // æ›´æ–°ç±»å‹å¯¹æ¯”å›¾
        function updateComparisonChart() {
            const typeStats = {};
            const typeNames = {
                jewelry: 'é¦–é¥°é»„é‡‘',
                physical: 'å®ç‰©é»„é‡‘',
                gold_bar: 'é‡‘æ¡'
            };

            // è®¡ç®—æ¯ç§ç±»å‹çš„ç»Ÿè®¡æ•°æ®
            Object.keys(allGoldData).forEach(type => {
                const data = allGoldData[type];
                if (data && data.length > 0) {
                    const prices = data.map(item => item.ä»·æ ¼_æ•°å€¼).filter(price => price > 0);
                    if (prices.length > 0) {
                        typeStats[type] = {
                            name: typeNames[type],
                            avgPrice: prices.reduce((sum, price) => sum + price, 0) / prices.length,
                            maxPrice: Math.max(...prices),
                            minPrice: Math.min(...prices),
                            count: prices.length
                        };
                    }
                }
            });

            const types = Object.keys(typeStats);
            const avgPrices = types.map(type => typeStats[type].avgPrice);
            const maxPrices = types.map(type => typeStats[type].maxPrice);
            const minPrices = types.map(type => typeStats[type].minPrice);
            const labels = types.map(type => typeStats[type].name);

            if (comparisonChart) {
                comparisonChart.destroy();
            }

            const ctx = document.getElementById('comparisonChart').getContext('2d');
            comparisonChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'å¹³å‡ä»·æ ¼',
                            data: avgPrices,
                            backgroundColor: '#667eea',
                            borderColor: '#667eea',
                            borderWidth: 2
                        },
                        {
                            label: 'æœ€é«˜ä»·æ ¼',
                            data: maxPrices,
                            backgroundColor: '#f093fb',
                            borderColor: '#f093fb',
                            borderWidth: 2
                        },
                        {
                            label: 'æœ€ä½ä»·æ ¼',
                            data: minPrices,
                            backgroundColor: '#4facfe',
                            borderColor: '#4facfe',
                            borderWidth: 2
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'ä¸åŒç±»å‹é»„é‡‘ä»·æ ¼å¯¹æ¯”'
                        },
                        legend: {
                            display: true,
                            position: 'top'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false,
                            title: {
                                display: true,
                                text: 'ä»·æ ¼ (å…ƒ/å…‹)'
                            }
                        }
                    }
                }
            });
        }

        // æ›´æ–°æ•°æ®è¡¨æ ¼
        function updateTable() {
            const selectedBrand = document.getElementById('tableBrandFilter').value;
            const sortBy = document.getElementById('sortBy').value;
            
            let filteredData = goldData;
            if (selectedBrand !== 'all') {
                filteredData = goldData.filter(item => item.å“ç‰Œ === selectedBrand);
            }
            
            // æ’åº
            filteredData.sort((a, b) => {
                switch(sortBy) {
                    case 'date':
                        return new Date(b.æ—¥æœŸ) - new Date(a.æ—¥æœŸ);
                    case 'price':
                        return b.ä»·æ ¼_æ•°å€¼ - a.ä»·æ ¼_æ•°å€¼;
                    case 'brand':
                        return a.å“ç‰Œ.localeCompare(b.å“ç‰Œ);
                    default:
                        return 0;
                }
            });
            
            const tbody = document.getElementById('tableBody');
            tbody.innerHTML = '';
            
            filteredData.forEach(item => {
                const row = document.createElement('tr');
                const changeClass = item.æ¶¨è·Œ === 'æ¶¨' ? 'price-up' : 
                                  item.æ¶¨è·Œ === 'è·Œ' ? 'price-down' : 'price-same';
                
                row.innerHTML = `
                    <td>${item.æ—¥æœŸ}</td>
                    <td>${item.é»„é‡‘ç±»å‹ || 'é¦–é¥°é»„é‡‘'}</td>
                    <td>${item.å“ç‰Œ}</td>
                    <td>${item.äº§å“ || '-'}</td>
                    <td>${item.ä»·æ ¼}</td>
                    <td class="${changeClass}">${item.æ¶¨è·Œ}</td>
                    <td>${item.æ•°æ®æ¥æº}</td>
                `;
                tbody.appendChild(row);
            });
        }

        // é¡µé¢åŠ è½½å®ŒæˆååŠ è½½æ•°æ®
        document.addEventListener('DOMContentLoaded', function() {
            loadGoldData();
        });
    </script>
</body>
</html>
